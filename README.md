# MADSOFT
### Алексеев Роман

## Начало работы
1. Клонируйте данные из репозитория
2. Перейдите в директорию *MADSOFT_test_task*
3. Запустите команды: <br>
  ```docker compose build```<br>
  ```docker compose up```
4. Публичный API доступен по адресу http://127.0.0.1:8080/
5. Документация доступна по адресу http://127.0.0.1:8080/docs

## Использование
### GET
Запрос GET имеет два варианта:
1. /memes/meme_id=*id* <br>
   Где *id* - id мема в базе данных. Аргумент является необязательным. Запрос возвращает список из одного объекта, содержащего текст и изображение в виде строки байтов.
2. /memes/page_number=*number* <br>
  Где *number* - номер страницы для пангинации, на каждой странцие находится 10 мемов, нумерация страниц с 0. Аргумент является необязательным, по умолчанию равен 0. Запрос возвращает список нескольких объектов, содержащих текст и изображение в виде строки байтов. <br>
  
Второй вариант использования вызывается автоматически, если пользователь не указал *id* мема, в противном случае вызывается первый вариант, даже при указанном номере страницы.

#### GET image
Для визуализации результата вызова в SwagerUI добавлен ещё один запрос GET /memes/image/meme_id=*id*. <br>
Данный запрос возвращает только изображение, которое отображается в SwagerUI, что позволяет пользователю визуально оценить изображение вместо строки байтов.

### POST
Запрос POST имеет структуру:
- text - текст мема
- img_meme - изображение мема
Оба аргумента являются обязательными.

Запрос возвращает объект с полями:
- ok - флаг успешность выполнения (True или False)
- id - присвоенный мему id
- result - строка с сообщением о результате

### PUT
Запрос PUT имеет структуру:
- id - id мема
- text -  новый текст для мема
- img_meme - новое изображение для мема
Все аргументы являются обязательными.

Запрос возвращает объект с полями:
- ok - флаг успешность выполнения (True или False)
- id - id измененного мема
- result - строка с сообщением о результате

### DELETE
Запрос DELETE имеет структуру:
- meme_id - id мема
Поле является обзательным.

Запрос возвращает объект с полями:
- ok - флаг успешность выполнения (True или False)
- id - id удаленного мема
- result - строка с сообщением о результате

## Описание работы
Приложение состоит из 4 сервисов:
- Public API - API доступный по http://127.0.0.1:8080/, используемые для взаимодействия пользователя с приложением для отправки запросов, а также для взаимодействия с Private API и SQL БД.
- Private API - API доступный внутри Docker контейнеров, исполуземый для взаимодейтсвия с S3 хранилищем.
- SQL DB - база данных для хранения текстов мемов.
- MinIO - S3 хранилище для хранения изображений мемов.

При отправке запроса к Public API сначала в SQL DB сохраняются (удаляются, изменяются, извлекаются) тектовые данные. Далее отправляется запрос к Private API, в котором передается строка байтов изображения. В Private API в MinIO сохраняется (удаляется, изменяется, извлекается) строка байтов.

При запуске контейнеров SQL БД инициализируется сущностью `text`, в которой хранятся тексты мемов, а MinIO инициализируется бакетом `madsoft-test-task`.

## Тестирование
Для тестирования был написан ряд тестов при помощи PyTest. Для запуска тестов:
- Запустите приложение (раздел "Начало работы")
- Перейдите в директорию tests
- Выполните команду ```pytest -v tests.py```

## Обращение разработчика
Уважаемые MADSOFT. <br>

Решение вашего тестового задания заняло прмиерно 25 часов. До начала решения я не взаимодействовал с S3, а также имел лишь небольшой опыт работы с FastAPI, т.к. обычно использовал Flask. Результат, представленный в данном репозитории, показывает, что я готов и способен изучать новые технологии самостоятельно и, тем более, при наличии страших товарищей, а также могу использовать их в работе. <br>
Надеюсь на положительный ответ. <br>

С уважением, Алексеев Роман.
